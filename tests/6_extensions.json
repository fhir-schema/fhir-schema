{
  "desc": "extensions",
  "schemas": {
    "string":  { "kind": "primitive-type" },
    "http://hl7.org/us-core-race": {
      "kind": "extension",
      "elements": {
        "choices": ["valueString"]
      }
    },
    "Extension": {
      "elements": {
        "url": {"type": "string"},
        "value": {"choices": ["valueString", "valueCode"]},
        "valueString": {"choiceOf": "value", "type": "string"},
        "valueCode":   {"choiceOf": "value", "type": "string"}
      }
    },
    "Resource": {
      "extensions": {
        "us-core-race": {
          "url": "http://hl7.org/us-core-race",
          "max": 1
        }
      },
      "elements": {
        "resourceType": { "type": "string" },
        "extension":    { "type": "Extension", "array": true },
        "element":      { "type": "string" }
      }
    }
  },
  "tests": [
    {
      "desc": "unknown extension - just check the shape",
      "data": {
        "resourceType": "Resource",
        "extension": [
          {
            "url": "unknown",
            "valueString": "string"
          },
          {
            "url": "unknown",
            "valueCode": "code"
          }
        ]
      }
    },
    {
      "desc": "broken extension schema",
      "data": {
        "resourceType": "Resource",
        "extension": [
          {
            "url": "http://hl7.org/us-core-race",
            "valueCode": "wrong"
          }
        ]
      },
      "errors": {
        "path": "Resource.extension.0"
      }
    }
  ]
}
